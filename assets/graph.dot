digraph G {
  // Set overall layout and graph attributes
  rankdir="RL";
  bgcolor="#ffffff";
  fontname="Helvetica";
  fontsize=10;
  label="Terraform Dependency Graph";
  labelloc="t";
  labeljust="c";

  // Global node styling
  node [
    shape=box,
    style="rounded,filled",
    fontname="Helvetica",
    fontsize=10,
    fillcolor="#E8E8E8",
    color="#333333"
  ];

  // Global edge styling
  edge [
    fontname="Helvetica",
    fontsize=8,
    color="#666666",
    arrowhead=vee
  ];

  // Define an external connectivity node for 0.0.0.0/0
  "anywhere" [label="0.0.0.0/0", shape=ellipse, style="filled", fillcolor="#FFD700", fontname="Helvetica", fontsize=10, color="#CC0000"];

  // Cluster for module.alb
  subgraph cluster_module_alb {
    label = "module.alb";
    style=filled;
    fillcolor="#D0E6F7";
    fontname="Helvetica";
    "module.alb.aws_lb.main" [label="aws_lb.main"];
    "module.alb.aws_lb_listener.http" [label="aws_lb_listener.http"];
    "module.alb.aws_lb_listener.https" [label="aws_lb_listener.https"];
    "module.alb.aws_lb_target_group.main" [label="aws_lb_target_group.main"];
  }

  // Cluster for module.asg
  subgraph cluster_module_asg {
    label = "module.asg";
    style=filled;
    fillcolor="#E2D6F7";
    fontname="Helvetica";
    "module.asg.data.aws_ami.amazon_linux_2_free_tier" [label="data.aws_ami.amazon_linux_2_free_tier"];
    "module.asg.aws_autoscaling_group.nginx_web_asg" [label="aws_autoscaling_group.nginx_web_asg"];
    "module.asg.aws_autoscaling_policy.scale_in" [label="aws_autoscaling_policy.scale_in"];
    "module.asg.aws_autoscaling_policy.scaling_out" [label="aws_autoscaling_policy.scaling_out"];
    "module.asg.aws_cloudwatch_metric_alarm.cpu_high" [label="aws_cloudwatch_metric_alarm.cpu_high"];
    "module.asg.aws_cloudwatch_metric_alarm.cpu_low" [label="aws_cloudwatch_metric_alarm.cpu_low"];
    "module.asg.aws_launch_template.nginx_web_lt" [label="aws_launch_template.nginx_web_lt"];
  }

  // Cluster for module.vpc
  subgraph cluster_module_vpc {
    label = "module.vpc";
    style=filled;
    fillcolor="#DFF7D9";
    fontname="Helvetica";
    "module.vpc.aws_eip.nat_eip" [label="aws_eip.nat_eip"];
    "module.vpc.aws_internet_gateway.igw" [label="aws_internet_gateway.igw"];
    "module.vpc.aws_nat_gateway.nat" [label="aws_nat_gateway.nat"];
    "module.vpc.aws_route_table.private_rt" [label="aws_route_table.private_rt"];
    "module.vpc.aws_route_table.public_rt" [label="aws_route_table.public_rt"];
    "module.vpc.aws_route_table_association.private_association" [label="aws_route_table_association.private_association"];
    "module.vpc.aws_route_table_association.public_association" [label="aws_route_table_association.public_association"];
    "module.vpc.aws_security_group.alb_sg" [label="aws_security_group.alb_sg"];
    "module.vpc.aws_security_group.ec2_sg" [label="aws_security_group.ec2_sg"];
    "module.vpc.aws_security_group.rds_sg" [label="aws_security_group.rds_sg"];
    "module.vpc.aws_subnet.private" [label="aws_subnet.private"];
    "module.vpc.aws_subnet.public" [label="aws_subnet.public"];
    "module.vpc.aws_vpc.main" [label="aws_vpc.main"];
  }

  // Define edges between resources
  "module.alb.aws_lb.main" -> "module.vpc.aws_security_group.alb_sg";
  "module.alb.aws_lb.main" -> "module.vpc.aws_subnet.public";
  "module.alb.aws_lb_listener.http" -> "module.alb.aws_lb.main";
  "module.alb.aws_lb_listener.http" -> "module.alb.aws_lb_target_group.main";
  "module.alb.aws_lb_listener.https" -> "module.alb.aws_lb.main";
  "module.alb.aws_lb_listener.https" -> "module.alb.aws_lb_target_group.main";
  "module.alb.aws_lb_target_group.main" -> "module.vpc.aws_vpc.main";
  "module.asg.aws_autoscaling_group.nginx_web_asg" -> "module.alb.aws_lb_target_group.main";
  "module.asg.aws_autoscaling_group.nginx_web_asg" -> "module.asg.aws_launch_template.nginx_web_lt";
  "module.asg.aws_autoscaling_group.nginx_web_asg" -> "module.vpc.aws_subnet.public";
  "module.asg.aws_autoscaling_policy.scale_in" -> "module.asg.aws_autoscaling_group.nginx_web_asg";
  "module.asg.aws_autoscaling_policy.scaling_out" -> "module.asg.aws_autoscaling_group.nginx_web_asg";
  "module.asg.aws_cloudwatch_metric_alarm.cpu_high" -> "module.asg.aws_autoscaling_policy.scaling_out";
  "module.asg.aws_cloudwatch_metric_alarm.cpu_low" -> "module.asg.aws_autoscaling_policy.scale_in";
  "module.asg.aws_launch_template.nginx_web_lt" -> "module.asg.data.aws_ami.amazon_linux_2_free_tier";
  "module.vpc.aws_internet_gateway.igw" -> "module.vpc.aws_vpc.main";
  // Connect external communication: Internet Gateway to Anywhere
  "module.vpc.aws_internet_gateway.igw" -> "anywhere";
  "anywhere" -> "module.vpc.aws_internet_gateway.igw";
  "module.vpc.aws_eip.nat_eip" -> "anywhere";
  "module.vpc.aws_nat_gateway.nat" -> "module.vpc.aws_eip.nat_eip";
  "module.vpc.aws_nat_gateway.nat" -> "module.vpc.aws_subnet.public";
  "module.vpc.aws_route_table.private_rt" -> "module.vpc.aws_nat_gateway.nat";
  "module.vpc.aws_route_table.public_rt" -> "module.vpc.aws_internet_gateway.igw";
  "module.vpc.aws_route_table_association.private_association" -> "module.vpc.aws_route_table.private_rt";
  "module.vpc.aws_route_table_association.private_association" -> "module.vpc.aws_subnet.private";
  "module.vpc.aws_route_table_association.public_association" -> "module.vpc.aws_route_table.public_rt";
  "module.vpc.aws_route_table_association.public_association" -> "module.vpc.aws_subnet.public";
  "module.vpc.aws_security_group.alb_sg" -> "module.vpc.aws_vpc.main";
  "module.vpc.aws_security_group.ec2_sg" -> "module.vpc.aws_security_group.alb_sg";
  "module.vpc.aws_security_group.rds_sg" -> "module.vpc.aws_security_group.ec2_sg";
  "module.vpc.aws_subnet.private" -> "module.vpc.aws_vpc.main";
  "module.vpc.aws_subnet.public" -> "module.vpc.aws_vpc.main";
}
